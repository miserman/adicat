function process_span(e){if("on"===options.live){var t,n,a,i=window.getSelection(),l=i.getRangeAt(0),r=l.startContainer.parentNode,s=2*options.nback;if("SPAN"===r.tagName){if(0!==r.children.length){if(t=new adicat(r.innerText).categorize(patterns.dict,options.blacklist).display(),n=r.previousElementSibling){for("blankspace"!==n.className&&insertSpace(n),a=t.length;a--;)n.insertAdjacentElement("afterEnd",t[a]),insertSpace(n);l.setStart(r,0),r.parentNode.removeChild(r)}}else r.history&&r.history===r.innerText||(t=new adicat(r.innerText).categorize(patterns.dict,options.blacklist),t.captured&&(t=t.display()[0],r.className=t.className,r.title=t.title,r.history=t.innerText));for(;s--&&r.previousElementSibling;)if(r=r.previousElementSibling,"blankspace"===r.className)"blankspace"===r.nextSibling.className&&r.parentNode.removeChild(r);else if(!r.history||r.history!==r.innerText||/\-\s/.test(r.innerText))if("blankspace"!==r.nextSibling.className&&insertSpace(r),r.style&&(r.style=""),t=new adicat(r.innerText).categorize(patterns.dict,options.blacklist).display(),1!==t.length){n=r.nextElementSibling,r.parentNode.removeChild(r),console.log(r);for(var a=0,s=t.length;a<s;a++)n.insertAdjacentElement("beforeBegin",t[a]),a!==s-1&&insertSpace(n)}else r.className=t[0].className,r.title=t[0].title,r.history=t[0].innerText;update_table()}i.removeAllRanges(),i.addRange(l)}}function spanner(e){if("on"===options.live){var t,n,n=window.getSelection(),a=n.getRangeAt(0),i=a.startContainer.parentNode;a.deleteContents(),13===e.which||8===e.which||32===e.which&&32===input_history||32===e.which&&1!==a.startOffset&&(32===e.which?(insertSpace(i),a.setStartAfter(i.nextSibling),e.preventDefault()):(t=document.createElement("span"),t.appendChild(c=document.createTextNode("-")),a.insertNode(t),a.setStartBefore(c),a.setEndAfter(c)),n.removeAllRanges(),n.addRange(a)),input_history=e.which}}function catch_paste(e){if("on"===options.live){var t=(e.clipboardData||window.clipboardData).getData("Text");if(/\r*\n/.test(t))return setTimeout(input_refresh,0),null;e.stopPropagation(),e.preventDefault();var n=window.getSelection(),a=n.getRangeAt(0);if(""===input.innerText)display_text(t),a.setStart(input.lastElementChild,1);else{var i,l,r=new adicat(t).categorize(patterns.dict,options.blacklist).display(),s=r.length;for(a.deleteContents(),e=a.startContainer.parentNode,i=e.nextElementSibling,(l="blankspace"===e.className)&&insertSpace(e),"input"!==e.id&&(e=input.children[0],i=e.nextSibling||e);s--;)e.insertAdjacentElement("afterEnd",r[s]),!s&&l||insertSpace(e);a.setStart(i,0),update_table()}n.removeAllRanges(),n.addRange(a)}}function input_clear(){input.innerHTML="",values.innerHTML=""}function input_refresh(){var e=input.innerText,t=/\r*\n/;if(input_clear(),t.test(e)){var n=window.getSelection(),a=n.getRangeAt(0);e=e.split(t);for(var i=e.length,l=0;l<i;l++)""!==e[l]&&display_text(e[l],!0),l!==i-1&&input.appendChild(document.createElement("br"));a.setStartAfter(input.lastElementChild),a.setEndAfter(input.lastElementChild),n.removeAllRanges(),n.addRange(a),update_table(),input.focus()}else display_text(e)}function display_text(e,t){if("string"==typeof(e=e||input.innerText)){for(var n=new adicat(e).categorize(patterns.dict,options.blacklist).display(),a=n.length,i=0;i<a;i++)input.appendChild(n[i]),append(input,"span",{innerHTML:options.space,className:"blankspace"});t||update_table()}}function update_table(){if(""===values.innerHTML){values.innerHTML="<table><tr class='highlight'></tr><tr></tr></table>";var e=values.children[0].children[0].children;append(e[0],"th",{innerText:"WC",title:"word count"}),append(e[1],"td",{innerText:0,id:"wc_value"})}var t,n,a,i,e=values.children[0].children[0].children,l=(e.length,input.children),r=l.length,s={wc:0},l=input.getElementsByTagName("span"),r=l.length,s={wc:0},c=/^ | $/g;for(t in patterns.dict)patterns.dict.hasOwnProperty(t)&&-1===options.blacklist.indexOf(t)&&(s[t]=0);for(;r--;)if("blankspace"!==l[r].className)for(a=l[r].className.replace(c,"").split(" "),t=a.length,s.wc+=1;t--;)i=a[t],s.hasOwnProperty(i)&&(s[i]+=1);for(t in s)s.hasOwnProperty(t)&&"wc"!==t&&("percent"===options.values&&0!==s[t]&&(s[t]=Math.round(s[t]/s.wc*1e4)/100),(n=document.getElementById(t+"_value"))?(n.innerText=s[t],i=s[t]?" "+t+" ":"zero",document.getElementById(t+"_title").className=i,n.className=i):(e[0].children.length||(append(e[0],"th",{innerText:"WC",title:"word count"}),append(e[1],"td",{innerText:0,id:"wc_value"})),append(e[0],"th",{innerText:t,id:t+"_title",className:s[t]?" "+t+" ":"zero"}),append(e[1],"td",{innerText:s[t],id:t+"_value",className:s[t]?"":"zero"})));$("wc_value").innerText=s.wc}function select(e){for(var t=/ select /g,n=t.test(e.className),a=n?t:new RegExp("( "+e.innerText+" )","g"),i=n?"":"$1 select ",l=values.children[0].children[0].children[0].children,r=l.length,s=input.children.length;s--;)""!==input.children[s].innerText&&(input.children[s].className=input.children[s].className.replace(t,"").replace(a,i));for(;r--;)"zero"!==l[r].className&&(l[r].className=l[r].className.replace(t," "));n||(e.className+="select ")}function append(e,t,n){var a,i=document.createElement(t);for(a in n)""===i[a]&&(i[a]=n[a]);e.appendChild(i)}function insertSpace(e,t){var n=document.createElement("span");n.className="blankspace",n.innerHTML=options.space,e.insertAdjacentElement(t||"afterEnd",n)}var input=document.getElementById("input"),values=document.getElementById("values"),options={values:"count",blacklist:[],live:"on",nback:5,space:"â€ˆ"};