"use strict";Adicat.hl={input:document.createElement("div"),values:document.createElement("div"),kbl:[0,8,13,40,39,38,37],input_history:0,texts:{current:0,comp:null,last:0},options:{values:"count",blacklist:[],live:"on",tabulate:!1,nback:5,show_zeros:"false",space_character:"â€ˆ",use_dict:"default",sim_cats:["article","prep","adverb","conj","auxverb","ipron","ppron"],sim_metric:"canberra",sim_filter:"false",split:"\\n+",sep:",",meta:!0,input_encoding:"ascii",dict:{default:{colors:{article:"#82c473",prep:"#a378c0",adverb:"#616161",conj:"#9f5c61",auxverb:"#d3d280",ipron:"#6970b2",ppron:"#78c4c2"},composites:{femcomp:{show:!0,formula:"ppron + auxverb + adverb + conj - article - prep"}}}}},output:{},colors:{"#C95B76":["#C95B76","#C9AA73","#B988B5","#CA6535","#6875FF","#A97A75","#8964B5","#A56874","#BB6875","#C95837"],"#C837B4":["#C837B4","#E966A4","#C997C3","#9967D3","#C999E4","#D857B4","#9C67B4","#C93AB3","#9965B3","#8D6794"],"#BB66C0":["#BB66C0","#9765BF","#9E36BE","#9786F0","#BA6ABE","#9A6382","#AA76C2","#9E46BD","#9A36BF","#9B34C0"],"#B46FCC":["#B46FCC","#6470B8","#3340CC","#B370CF","#73409C","#446FCC","#8450CC","#6340CC","#7442FF","#9472C8"],"#47CBC2":["#47CBC2","#85E9C0","#87AAC0","#77E9C2","#77CBFF","#67A5B0","#97C8BD","#67A9F2","#9AC9D0","#59D9C0"],"#69D5A6":["#69D5A6","#AD67FF","#9D66FF","#40E866","#3AE566","#8DE966","#6FE466","#ADE36A","#6DB5A9","#3DE969"],"#DEE176":["#DEE176","#FECF65","#DECEAA","#DECE69","#CF64FF","#DECF3A","#BE9F69","#DED266","#DBEF68","#DED2A7"]},process_span:function(){if("on"===Adicat.hl.options.live){var t,e,a,i,n=window.getSelection(),l=n.getRangeAt(0),c=l.startContainer.parentNode,s=Adicat.hl.options.nback;if("BODY"===c.tagName&&(Adicat.hl.input.lastElementChild?(l.setStartBefore(Adicat.hl.input.lastElementChild),l.setEndAfter(Adicat.hl.input.lastElementChild),l.collapse(!1)):Adicat.hl.input.focus(),l=n.getRangeAt(0),c=l.startContainer.parentNode),"SPAN"===c.tagName){if(0!==c.children.length){if(t=new adicat(c.innerText).categorize(Adicat.patterns.dict,Adicat.hl.options.blacklist).display(),(e=c.previousElementSibling)&&"blankspace"!==c.className){for(i=t.length;i--;)Adicat.hl.insertSpace(e),e.insertAdjacentElement("afterEnd",t[i]);l.setStart(c,0),c.parentNode.removeChild(c)}}else c.history&&c.history===c.innerText||(t=new adicat(c.innerText).categorize(Adicat.patterns.dict,Adicat.hl.options.blacklist),t.captured?(t=t.display()[0],c.className=t.className,c.title=t.title,c.history=t.innerText):(c.className=" none ",c.title="none",c.history=c.innerText));for(;s--&&c.previousElementSibling;)if(c=c.previousElementSibling,"SPAN"===c.tagName){if("blankspace"===c.className)(a=c.previousElementSibling)&&a.innerText===Adicat.hl.options.space_character&&a.parentNode.removeChild(a);else if(!c.history||c.history!==c.innerText)if(c.style&&(c.className=c.title=""),t=new adicat(c.innerText).categorize(Adicat.patterns.dict,Adicat.hl.options.blacklist).display(),1!==t.length){for(i=t.length;i--;)c.insertAdjacentElement("afterEnd",t[i]),i&&Adicat.hl.insertSpace(c);c.parentNode.removeChild(c)}else c.className=t[0].className,c.title=t[0].title,c.history=t[0].innerText;Adicat.hl.options.tabulate&&Adicat.hl.update_table()}}n.removeAllRanges(),n.addRange(l)}},spanner:function(t){if("on"===Adicat.hl.options.live){var e,a,i,n,l=window.getSelection(),c=l.getRangeAt(0),s=c.startContainer.parentNode;if(c.deleteContents(),-1!==Adicat.hl.kbl.indexOf(t.which)||32===t.which&&32===Adicat.hl.input_history)return null;if(32===t.which&&0!==c.startOffset||"SPAN"!==s.tagName){if(32===t.which)if(c.startOffset!==s.innerText.length){if("SPAN"===s.tagName){for(e=new adicat(s.innerText.substring(0,c.startOffset)).categorize(Adicat.patterns.dict,Adicat.hl.options.blacklist).display(),n=e[e.length-1],e=e.concat(new adicat(s.innerText.substring(c.startOffset)).categorize(Adicat.patterns.dict,Adicat.hl.options.blacklist).display()),i=e.length,"blankspace"!==s.className&&Adicat.hl.insertSpace(s);i--;)s.insertAdjacentElement("afterEnd",e[i]),i&&Adicat.hl.insertSpace(s);c.setStart(n.nextElementSibling,1),"blankspace"!==s.className&&s.parentNode.removeChild(s),t.preventDefault()}}else Adicat.hl.insertSpace(s),c.setStartAfter(s.nextSibling),c.setEndAfter(s.nextSibling),c.collapse(!1),t.preventDefault(),s.history&&s.history===s.innerText||(a=new adicat(s.innerText).categorize(Adicat.patterns.dict,Adicat.hl.options.blacklist),a.captured?(a=a.display()[0],s.className=a.className,s.title=a.title,s.history=a.innerText):(s.className=" none ",s.title="none",s.history=s.innerText));else e=document.createElement("span"),e.appendChild(a=document.createTextNode(Adicat.hl.options.space_character)),c.insertNode(e),c.setStartBefore(a),c.setEndAfter(a);l.removeAllRanges(),l.addRange(c)}Adicat.hl.input_history=t.which}},display_text:function(t,e){if("string"==typeof(t=t||Adicat.hl.input.innerText)){e||(Adicat.hl.input.innerText=""),t=Adicat.filterOut(t.split(Adicat.patterns.returns),"");for(var a,i,n,l=0,c=t.length;l<c;l++)for(n=new adicat(t[l]).categorize(Adicat.patterns.dict,Adicat.hl.options.blacklist).display(),i=n.length,l<c-1&&(n[i]=document.createElement("div"),n[i].appendChild(document.createElement("span")),n[i].firstElementChild.className="blankspace",n[i].firstElementChild.appendChild(document.createElement("br")),i++),a=0;a<i;a++)Adicat.hl.input.appendChild(n[a]),"SPAN"===n[a].tagName&&Adicat.hl.append(Adicat.hl.input,"span",{innerHTML:Adicat.hl.options.space_character,className:"blankspace"});!e&&Adicat.hl.options.tabulate&&Adicat.hl.update_table()}},update_table:function(){if(""===Adicat.hl.values.innerHTML){Adicat.hl.values.innerHTML="<table><tr class='highlight'></tr><tr></tr></table>";var t=Adicat.hl.values.children[0].children[0].children;Adicat.hl.append(t[0],"th",{innerText:"WC",title:"word count"}),Adicat.hl.append(t[1],"td",{innerText:0,id:"wc_value"})}var e,a,i,n,l,t=Adicat.hl.values.children[0].children[0].children,c=(t.length,Adicat.hl.input.children),s=c.length,c=Adicat.hl.input.getElementsByTagName("span"),s=c.length,r={wc:0},d=/^ | $/g,o=Adicat.hl.options.dict[Adicat.hl.options.use_dict].composites||{},p=document.getElementById("wc_value");p||(Adicat.hl.values.style.display="none",document.body.appendChild(Adicat.hl.values),p=document.getElementById("wc_value"));for(e in Adicat.patterns.dict)Adicat.patterns.dict.hasOwnProperty(e)&&-1===Adicat.hl.options.blacklist.indexOf(e)&&(r[e]=0);for(;s--;)if(Adicat.patterns.char.test(c[s].innerText))for(i=c[s].className.replace(d,"").split(" "),e=i.length,r.wc++;e--;)n=i[e],r.hasOwnProperty(n)&&r[n]++;for(e in r)if(r.hasOwnProperty(e)&&"wc"!==e)if("percent"===Adicat.hl.options.values&&0!==r[e]&&(r[e]=Math.round(r[e]/r.wc*1e4)/100),Adicat.hl.output[e]=r[e],a=document.getElementById(e+"_value"))a.innerText=r[e],n=r[e]||"true"===Adicat.hl.options.show_zeros?" "+e+" ":"zero",document.getElementById(e+"_title").className=n,a.className=n;else{if(t[0].children.length||(Adicat.hl.append(t[0],"th",{innerText:"WC",title:"word count"}),Adicat.hl.append(t[1],"td",{innerText:0,id:"wc_value"})),1===t[0].children.length){Adicat.hl.texts.comp&&Adicat.hl.texts.hasOwnProperty(Adicat.hl.texts.comp)&&(Adicat.hl.append(t[0],"th",{innerText:"sim to "+Adicat.hl.texts.comp,title:(/^co/i.test(Adicat.hl.options.sim_metric)?"Cosine similarity":"Inverse Canberra distance")+" to text "+Adicat.hl.texts.comp+"; click to recalculate."}),Adicat.hl.texts.comp_values=new adicat(Adicat.hl.texts[Adicat.hl.texts.comp]).categorize().toPercent().cats,Adicat.hl.append(t[1],"td",{innerText:0,id:"similarity"}),document.getElementById("similarity").parentElement.parentElement.children[0].children[1].addEventListener("click",Adicat.hl.sim_refresh));for(a in o)o.hasOwnProperty(a)&&o[a].show&&(Adicat.hl.append(t[0],"th",{innerText:a,title:o[a].formula}),Adicat.hl.append(t[1],"td",{innerText:0,id:"comp_"+a}))}Adicat.hl.append(t[0],"th",{innerText:e,id:e+"_title",className:r[e]||"true"===Adicat.hl.options.show_zeros?" "+e+" ":"zero"}),Adicat.hl.append(t[1],"td",{innerText:r[e],id:e+"_value",className:r[e]||"true"===Adicat.hl.options.show_zeros?"":"zero"})}Adicat.hl.texts.comp&&Adicat.hl.texts.comp_values&&(l=document.getElementById("similarity"))&&(l.innerText=Math.round(1e3*new adicat(Adicat.hl.input.innerText).similarity(Adicat.hl.texts.comp_values,Adicat.hl.options.sim_metric,"true"===Adicat.hl.options.sim_filter&&Adicat.hl.options.sim_cats).value)/1e3);for(a in o)o.hasOwnProperty(a)&&o[a].show&&(t=document.getElementById("comp_"+a))&&(t.innerText=Adicat.hl.solve(o[a].formula));p.innerText=r.wc},solve:function(t){function e(t){for(var t=t+"",e=t.match(r),a=e?e.length:0,i="",n=0;n<a;n++)i=e[n].replace(s,""),i=Adicat.hl.output.hasOwnProperty(i)?Number(Adicat.hl.output[i]):Number(i),isNaN(i)&&(i=0),t=t.replace(e[n],i);return t}var a=/\s|^Math\./g,i=/[^\.0-9+><*%^()&|\/-]/g,n=/^\(/,l=/^[^(]*/,c=/\([^(]+\)/g,s=/\s+/g,r=/[^+><*^()&%|\/-]+/g,d={},o=[],p="",h=0;if(t=t.replace(Adicat.patterns.returns," "),o=t.match(c)){for(h=o.length;h--;)d[o[h]]=o[h].replace(" ",""),p=d[o[h]].replace(d[o[h]],e(d[o[h]])),t=t.replace(o[h],p);for(o=t.match(/(^|[^(+><*^&|\/-]*)\([^()]*\)/g),h=o.length;h--;)d[o[h]]=o[h].replace(a,""),n.test(d[o[h]])||(p=d[o[h]].match(l),d[o[h]]=d[o[h]].replace(l,""),Math.hasOwnProperty(p)&&(d[o[h]]=Math[p](Number(Function('"use strict"; return '+d[o[h]].replace(i,""))())),isNaN(d[o[h]])&&(d[o[h]]=0))),t=t.replace(o[h],d[o[h]])}return t=e(t),t=Math.round(1e4*Function('"use strict"; return '+t.replace(i,""))())/1e4,isFinite(t)?t:0},sim_refresh:function(){var t=document.getElementById("similarity");t&&(Adicat.hl.texts.comp_values=new adicat(Adicat.hl.texts[Adicat.hl.texts.comp]).categorize().toPercent().cats,t.innerText=Math.round(1e3*new adicat(Adicat.hl.input.innerText).similarity(Adicat.hl.texts.comp_values,Adicat.hl.options.sim_metric,"true"===Adicat.hl.options.sim_filter&&Adicat.hl.options.sim_cats).value)/1e3)},select:function(t){var e,a=t.classList.contains("select"),i=Adicat.hl.input.getElementsByClassName("select");for(e=i.length;e--;)i[e].classList.remove("select");for(i=Adicat.hl.values.getElementsByClassName("select"),e=i.length;e--;)"zero"!==i[e].className&&i[e].classList.remove("select");if(!a)for(t.classList.add("select"),i=Adicat.hl.input.getElementsByClassName(t.innerText),e=i.length;e--;)""!==i[e].innerText&&i[e].classList.add("select")},insertSpace:function(t,e){var a=document.createElement("span");a.className="blankspace",a.innerHTML=Adicat.hl.options.space_character,t.insertAdjacentElement(e||"afterEnd",a)},append:function(t,e,a){var i,n=document.createElement(e);for(i in a)n[i]=a[i];t.appendChild(n)}};