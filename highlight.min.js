"use strict";function process_span(e){if("on"===options.live){var t,n,i,a,r=window.getSelection(),s=r.getRangeAt(0),l=s.startContainer.parentNode,c=options.nback;if("BODY"===l.tagName&&(input.lastElementChild?(s.setStartBefore(input.lastElementChild),s.setEndAfter(input.lastElementChild),s.collapse(!1)):input.focus(),s=r.getRangeAt(0),l=s.startContainer.parentNode),"SPAN"===l.tagName){if(l.firstElementChild&&"SPAN"!==l.firstElementChild.tagName&&l.removeChild(l.firstElementChild),0!==l.children.length){if(t=new adicat(l.innerText).categorize(patterns.dict,options.blacklist).display(),n=l.previousElementSibling){for(a=t.length;a--;)n.insertAdjacentElement("afterEnd",t[a]),a&&insertSpace(n);s.setStart(l,0),l.parentNode.removeChild(l)}}else l.history&&l.history===l.innerText||(t=new adicat(l.innerText).categorize(patterns.dict,options.blacklist),t.captured&&(t=t.display()[0],l.className=t.className,l.title=t.title,l.history=t.innerText));for(;c--&&l.previousElementSibling;)if(l=l.previousElementSibling,"SPAN"===l.tagName){if("blankspace"===l.className)(i=l.previousElementSibling)&&i.innerText===options.space_character&&i.parentNode.removeChild(i);else if(!l.history||l.history!==l.innerText)if(l.style&&(l.className=l.title=""),t=new adicat(l.innerText).categorize(patterns.dict,options.blacklist).display(),1!==t.length)for(n=l.nextElementSibling,l.parentNode.removeChild(l),a=0,c=t.length;a<c;a++)insertSpace(t[a]),n.insertAdjacentElement("beforeBegin",t[a]),a<c-1&&insertSpace(t[a]);else l.className=t[0].className,l.title=t[0].title,l.history=t[0].innerText;update_table()}}r.removeAllRanges(),r.addRange(s)}}function spanner(e){if("on"===options.live){var t,n,i,a,r=window.getSelection(),s=r.getRangeAt(0),l=s.startContainer.parentNode;if(s.deleteContents(),-1!==kbl.indexOf(e.which)||32===e.which&&32===input_history);else if(32===e.which&&0!==s.startOffset||"SPAN"!==l.tagName){if(32===e.which)if(s.startOffset!==l.innerText.length){if("SPAN"===l.tagName){for(t=new adicat(l.innerText.substring(0,s.startOffset)).categorize(patterns.dict,options.blacklist).display(),a=t[t.length-1],t=t.concat(new adicat(l.innerText.substring(s.startOffset)).categorize(patterns.dict,options.blacklist).display()),i=t.length,"blankspace"!==l.className&&insertSpace(l);i--;)l.insertAdjacentElement("afterEnd",t[i]),i&&insertSpace(l);s.setStart(a.nextElementSibling,1),l.parentNode.removeChild(l),e.preventDefault()}}else insertSpace(l),s.setStartAfter(l.nextSibling),s.setEndAfter(l.nextSibling),s.collapse(!1),e.preventDefault();else t=document.createElement("span"),t.appendChild(n=document.createTextNode(options.space_character)),s.insertNode(t),s.setStartBefore(n),s.setEndAfter(n);r.removeAllRanges(),r.addRange(s)}backup(!1,!0),input_history=e.which}}function catch_paste(e){if("on"===options.live){var t=(e.clipboardData||window.clipboardData).getData("Text");if(patterns.returns.test(t))return setTimeout(input_refresh,0),null;e.stopPropagation(),e.preventDefault();var n=window.getSelection(),i=n.getRangeAt(0);if(""===input.innerText||"\n"===input.innerText)display_text(t),i.setStart(input.lastElementChild,1);else{var a,r,s=new adicat(t).categorize(patterns.dict,options.blacklist).display(),l=s.length;for(i.deleteContents(),e="input"===i.startContainer.id?input.firstElementChild:i.startContainer.parentNode,"input"===e.id?e=i.startContainer:e!==input.firstElementChild||i.startOffset||(insertSpace(e,"beforeBegin"),e=input.firstElementChild),(r="blankspace"===e.className)&&insertSpace(e),a=e.nextElementSibling;l--;)e.insertAdjacentElement("afterEnd",s[l]),!l&&r||insertSpace(e);a&&i.setStart(a,"blankspace"===a.className),"blankspace"===input.firstElementChild.className&&input.removeChild(input.firstElementChild),update_table()}n.removeAllRanges(),n.addRange(i),i.collapse(!1)}}function input_clear(e){backup(!0),input.innerHTML=values.innerHTML="",e&&(texts.current=texts.hasOwnProperty(texts.current)?++texts.last:texts.last,fill_menu())}function input_refresh(){var e=input.innerText,t=window.getSelection(),n=t.getRangeAt(0);if(input_clear(),patterns.returns.test(e)){e=e.split(patterns.returns);for(var i=e.length,a=0;a<i;a++)""!==e[a]&&display_text(e[a],!0),a!==i-1&&input.appendChild(document.createElement("br"));update_table()}else display_text(e);input.lastElementChild&&n.setStart(input.lastElementChild,"SPAN"===input.lastElementChild.tagName),t.removeAllRanges(),t.addRange(n),backup(!0),input.focus()}function display_text(e,t){if("string"==typeof(e=e||input.innerText)){e=e.split(patterns.returns).filter(empty);for(var n,i,a,r=0,s=e.length;r<s;r++)for(a=new adicat(e[r]).categorize(patterns.dict,options.blacklist).display(),i=a.length,r<s-1&&(a[i]=document.createElement("div"),a[i].appendChild(document.createElement("span")),a[i].firstElementChild.className="blankspace",a[i].firstElementChild.appendChild(document.createElement("br")),i++),n=0;n<i;n++)input.appendChild(a[n]),"SPAN"===a[n].tagName&&append(input,"span",{innerHTML:options.space_character,className:"blankspace"});t||update_table()}}function update_table(){if(""===values.innerHTML){values.innerHTML="<table><tr class='highlight'></tr><tr></tr></table>";var e=values.children[0].children[0].children;append(e[0],"th",{innerText:"WC",title:"word count"}),append(e[1],"td",{innerText:0,id:"wc_value"})}var t,n,i,a,r,e=values.children[0].children[0].children,s=(e.length,input.children),l=s.length,s=input.getElementsByTagName("span"),l=s.length,c={wc:0},o=/^ | $/g,p=options.dict[options.use_dict].composites||{};for(t in patterns.dict)patterns.dict.hasOwnProperty(t)&&-1===options.blacklist.indexOf(t)&&(c[t]=0);for(;l--;)if(patterns.char.test(s[l].innerText))for(i=s[l].className.replace(o,"").split(" "),t=i.length,c.wc++;t--;)a=i[t],c.hasOwnProperty(a)&&c[a]++;for(t in c)if(c.hasOwnProperty(t)&&"wc"!==t)if("percent"===options.values&&0!==c[t]&&(c[t]=Math.round(c[t]/c.wc*1e4)/100),output[t]=c[t],n=document.getElementById(t+"_value"))n.innerText=c[t],a=c[t]||"true"===options.show_zeros?" "+t+" ":"zero",document.getElementById(t+"_title").className=a,n.className=a;else{if(e[0].children.length||(append(e[0],"th",{innerText:"WC",title:"word count"}),append(e[1],"td",{innerText:0,id:"wc_value"})),1===e[0].children.length){texts.comp&&texts.hasOwnProperty(texts.comp)&&(append(e[0],"th",{innerText:"sim to "+texts.comp,title:(/^co/i.test(options.sim_metric)?"Cosine similarity":"Inverse Canberra distance")+" to text "+texts.comp+"; click to recalculate."}),texts.comp_values=new adicat(texts[texts.comp]).categorize().toPercent(),append(e[1],"td",{innerText:0,id:"similarity"}),addEvent($("similarity").parentElement.parentElement.children[0].children[1],"click",sim_refresh));for(n in p)p.hasOwnProperty(n)&&p[n].show&&(append(e[0],"th",{innerText:n,title:p[n].formula}),append(e[1],"td",{innerText:0,id:"comp_"+n}))}append(e[0],"th",{innerText:t,id:t+"_title",className:c[t]||"true"===options.show_zeros?" "+t+" ":"zero"}),append(e[1],"td",{innerText:c[t],id:t+"_value",className:c[t]||"true"===options.show_zeros?"":"zero"})}texts.comp&&texts.comp_values&&(r=$("similarity"))&&(r.innerText=new adicat(input.innerText).similarity(texts.comp_values,options.sim_metric,options.sim_cats));for(n in p)p.hasOwnProperty(n)&&p[n].show&&(e=$("comp_"+n))&&(e.innerText=solve(p[n].formula));$("wc_value").innerText=c.wc}function sim_refresh(){var e=$("similarity");e&&(texts.comp_values=new adicat(texts[texts.comp]).categorize().toPercent(),e.innerText=new adicat(input.innerText).similarity(texts.comp_values,options.sim_metric,options.sim_cats))}function select(e){for(var t=/ select /g,n=t.test(e.className),i=n?t:new RegExp("( "+e.innerText+" )","g"),a=n?"":"$1 select ",r=values.children[0].children[0].children[0].children,s=r.length,l=input.children.length;l--;)""!==input.children[l].innerText&&(input.children[l].className=input.children[l].className.replace(t,"").replace(i,a));for(;s--;)"zero"!==r[s].className&&(r[s].className=r[s].className.replace(t," "));n||(e.className+="select ")}function append(e,t,n){var i,a=document.createElement(t);for(i in n)a[i]=n[i];e.appendChild(a)}function insertSpace(e,t){var n=document.createElement("span");n.className="blankspace",n.innerHTML=options.space_character,e.insertAdjacentElement(t||"afterEnd",n)}var input=document.getElementById("input"),values=document.getElementById("values"),kbl=[0,8,13,40,39,38,37],options={values:"count",blacklist:[],live:"on",nback:5,show_zeros:"false",space_character:"â€ˆ",use_dict:"default",sim_cats:["article","prep","adverb","conj","auxverb","ipron","ppron"],sim_metric:"canberra",dict:{default:{colors:{article:"#82c473",prep:"#a378c0",adverb:"#616161",conj:"#9f5c61",auxverb:"#d3d280",ipron:"#6970b2",ppron:"#78c4c2"},composites:{femcomp:{show:!0,formula:"ppron + auxverb + adverb + conj - article - prep"}}}}},output={},colors={"#C95B76":["#C95B76","#C9AA73","#B988B5","#CA6535","#6875FF","#A97A75","#8964B5","#A56874","#BB6875","#C95837"],"#C837B4":["#C837B4","#E966A4","#C997C3","#9967D3","#C999E4","#D857B4","#9C67B4","#C93AB3","#9965B3","#8D6794"],"#BB66C0":["#BB66C0","#9765BF","#9E36BE","#9786F0","#BA6ABE","#9A6382","#AA76C2","#9E46BD","#9A36BF","#9B34C0"],"#B46FCC":["#B46FCC","#6470B8","#3340CC","#B370CF","#73409C","#446FCC","#8450CC","#6340CC","#7442FF","#9472C8"],"#47CBC2":["#47CBC2","#85E9C0","#87AAC0","#77E9C2","#77CBFF","#67A5B0","#97C8BD","#67A9F2","#9AC9D0","#59D9C0"],"#69D5A6":["#69D5A6","#AD67FF","#9D66FF","#40E866","#3AE566","#8DE966","#6FE466","#ADE36A","#6DB5A9","#3DE969"],"#DEE176":["#DEE176","#FECF65","#DECEAA","#DECE69","#CF64FF","#DECF3A","#BE9F69","#DED266","#DBEF68","#DED2A7"]};