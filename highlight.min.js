function process_span(e){if("on"===options.live){var t,n,a,i=window.getSelection(),l=i.getRangeAt(0),s=l.startContainer.parentNode,r=2*options.nback;if("SPAN"===s.tagName){if(0!==s.children.length){if(t=new adicat(s.innerText).categorize(patterns.dict,options.blacklist).display(),n=s.previousElementSibling){for("blankspace"!==n.className&&insertSpace(n),a=t.length;a--;)n.insertAdjacentElement("afterEnd",t[a]),insertSpace(n);l.setStart(s,0),s.parentNode.removeChild(s)}}else s.history&&s.history===s.innerText||(t=new adicat(s.innerText).categorize(patterns.dict,options.blacklist),t.captured&&(t=t.display()[0],s.className=t.className,s.title=t.title,s.history=t.innerText));for(;r--&&s.previousElementSibling;)if(s=s.previousElementSibling,"blankspace"===s.className)"blankspace"===s.nextSibling.className&&s.parentNode.removeChild(s);else if(!s.history||s.history!==s.innerText||/\-\s/.test(s.innerText))if("blankspace"!==s.nextSibling.className&&insertSpace(s),s.style&&(s.style=""),t=new adicat(s.innerText).categorize(patterns.dict,options.blacklist).display(),1!==t.length){n=s.nextElementSibling,s.parentNode.removeChild(s),console.log(s);for(var a=0,r=t.length;a<r;a++)n.insertAdjacentElement("beforeBegin",t[a]),a!==r-1&&insertSpace(n)}else s.className=t[0].className,s.title=t[0].title,s.history=t[0].innerText;update_table()}i.removeAllRanges(),i.addRange(l)}}function spanner(e){if("on"===options.live){var t,n,n=window.getSelection(),a=n.getRangeAt(0),i=a.startContainer.parentNode;a.deleteContents(),13===e.which||8===e.which||32===e.which&&32===input_history||(32===e.which&&1!==a.startOffset||"SPAN"!==i.tagName)&&(32===e.which?(insertSpace(i),a.setStartAfter(i.nextSibling),a.setEndAfter(i.nextSibling),a.collapse(!1),e.preventDefault()):(t=document.createElement("span"),t.appendChild(c=document.createTextNode("-")),a.insertNode(t),a.setStartBefore(c),a.setEndAfter(c)),n.removeAllRanges(),n.addRange(a)),input_history=e.which}}function catch_paste(e){if("on"===options.live){var t=(e.clipboardData||window.clipboardData).getData("Text");if(/\r*\n/.test(t))return setTimeout(input_refresh,0),null;e.stopPropagation(),e.preventDefault();var n=window.getSelection(),a=n.getRangeAt(0);if(""===input.innerText)display_text(t),a.setStart(input.lastElementChild,1);else{var i,l,s=new adicat(t).categorize(patterns.dict,options.blacklist).display(),r=s.length;for(a.deleteContents(),e=a.startContainer.parentNode,i=e.nextElementSibling,(l="blankspace"===e.className)&&insertSpace(e),"input"!==e.id&&(e=input.children[0],i=e.nextSibling||e);r--;)e.insertAdjacentElement("afterEnd",s[r]),!r&&l||insertSpace(e);a.setStart(i,0),update_table()}n.removeAllRanges(),n.addRange(a)}}function input_clear(){input.innerHTML="",values.innerHTML=""}function input_refresh(){var e=input.innerText,t=/\r*\n/;if(input_clear(),t.test(e)){var n=window.getSelection(),a=n.getRangeAt(0);e=e.split(t);for(var i=e.length,l=0;l<i;l++)""!==e[l]&&display_text(e[l],!0),l!==i-1&&input.appendChild(document.createElement("br"));a.setStartAfter(input.lastElementChild),a.setEndAfter(input.lastElementChild),n.removeAllRanges(),n.addRange(a),update_table(),input.focus()}else display_text(e)}function display_text(e,t){if("string"==typeof(e=e||input.innerText)){for(var n=new adicat(e).categorize(patterns.dict,options.blacklist).display(),a=n.length,i=0;i<a;i++)input.appendChild(n[i]),append(input,"span",{innerHTML:options.space,className:"blankspace"});t||update_table()}}function update_table(){if(""===values.innerHTML){values.innerHTML="<table><tr class='highlight'></tr><tr></tr></table>";var e=values.children[0].children[0].children;append(e[0],"th",{innerText:"WC",title:"word count"}),append(e[1],"td",{innerText:0,id:"wc_value"})}var t,n,a,i,e=values.children[0].children[0].children,l=(e.length,input.children),s=l.length,r={wc:0},l=input.getElementsByTagName("span"),s=l.length,r={wc:0},c=/^ | $/g;for(t in patterns.dict)patterns.dict.hasOwnProperty(t)&&-1===options.blacklist.indexOf(t)&&(r[t]=0);for(;s--;)if("blankspace"!==l[s].className)for(a=l[s].className.replace(c,"").split(" "),t=a.length,r.wc+=1;t--;)i=a[t],r.hasOwnProperty(i)&&(r[i]+=1);for(t in r)r.hasOwnProperty(t)&&"wc"!==t&&("percent"===options.values&&0!==r[t]&&(r[t]=Math.round(r[t]/r.wc*1e4)/100),(n=document.getElementById(t+"_value"))?(n.innerText=r[t],i=r[t]?" "+t+" ":"zero",document.getElementById(t+"_title").className=i,n.className=i):(e[0].children.length||(append(e[0],"th",{innerText:"WC",title:"word count"}),append(e[1],"td",{innerText:0,id:"wc_value"})),append(e[0],"th",{innerText:t,id:t+"_title",className:r[t]?" "+t+" ":"zero"}),append(e[1],"td",{innerText:r[t],id:t+"_value",className:r[t]?"":"zero"})));$("wc_value").innerText=r.wc}function select(e){for(var t=/ select /g,n=t.test(e.className),a=n?t:new RegExp("( "+e.innerText+" )","g"),i=n?"":"$1 select ",l=values.children[0].children[0].children[0].children,s=l.length,r=input.children.length;r--;)""!==input.children[r].innerText&&(input.children[r].className=input.children[r].className.replace(t,"").replace(a,i));for(;s--;)"zero"!==l[s].className&&(l[s].className=l[s].className.replace(t," "));n||(e.className+="select ")}function append(e,t,n){var a,i=document.createElement(t);for(a in n)""===i[a]&&(i[a]=n[a]);e.appendChild(i)}function insertSpace(e,t){var n=document.createElement("span");n.className="blankspace",n.innerHTML=options.space,e.insertAdjacentElement(t||"afterEnd",n)}var input=document.getElementById("input"),values=document.getElementById("values"),options={values:"count",blacklist:[],live:"on",nback:5,space:"â€ˆ"};